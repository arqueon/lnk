// Niri configuration file

// Input device configuration
input {
    keyboard {
        numlock
        xkb {
            layout "us"
            variant "intl"
            options "ctrl:nocaps"
        }
        repeat-delay 300
        repeat-rate 25
    }

    touchpad {
        tap
        // dwt
        // dwtp
        // natural-scroll
        accel-speed 0.5
        accel-profile "adaptive"
    }

    mouse {
        // natural-scroll
        accel-speed 0.5
        accel-profile "adaptive"
    }

    // warp-mouse-to-focus
    focus-follows-mouse max-scroll-amount="40%"
    workspace-auto-back-and-forth
}


// Workspaces configuration
workspace "chat" {
    open-on-output "HDMI-A-1"
}
workspace "web" {
    open-on-output "DP-2"
}
workspace "ref" {
    open-on-output "HDMI-A-1"
}
workspace "notes" {
    open-on-output "HDMI-A-1"
}
workspace "write" {
    open-on-output "HDMI-A-1"
}
workspace "files" {
    open-on-output "DP-2"
}
workspace "virt" {
    open-on-output "DP-2"
}
workspace "media" {
    open-on-output "DP-2"
}


// Outputs configuration
output "DP-2" {
    // off
    mode "1920x1080@60.000"
    scale 1.0
    // transform "90"
    position x=1920 y=0
}

output "HDMI-A-1" {
    // off
    mode "1920x1080@60.000"
    scale 1.0
    // transform "90"
    position x=0 y=0
}


// Switch events
switch-events {
    //lid-close { spawn-sh "qs -c noctalia-shell ipc call lockScreen toggle"; }    
    lid-close { spawn "swaylock"; }
}


// Layout configuration
layout {
    gaps 15
    center-focused-column "never"
    default-column-display "tabbed"
    tab-indicator {
        // off
        hide-when-single-tab
        place-within-column
        gap 4
        width 15
        length total-proportion=1.0
        position "top"
        gaps-between-tabs 10
        corner-radius 0
        active-color "#89b4fa"
        inactive-color "gray"
        urgent-color "red"
        // active-gradient from="#80c8ff" to="#bbddff" angle=45
        // inactive-gradient from="#505050" to="#808080" angle=45 relative-to="workspace-view"
        // urgent-gradient from="#800" to="#a33" angle=45
    }
    preset-column-widths {
        proportion 0.25
        proportion 0.33333
        proportion 0.5
        proportion 0.66667
        proportion 0.75
        // fixed 1920
    }
    background-color "transparent"
    insert-hint {
        // off
        color "#ffc87f80"
        gradient from="#6b8c61" to="#a6da95" angle=45 relative-to="workspace-view"
    }
    default-column-width { proportion 0.5; }
    focus-ring {
        // off
        width 3
        active-color "#89b4fa"
        inactive-color "#3A3A3E"
        active-gradient from="#89b4fa" to="#a6da95" angle=45
        inactive-gradient from="#3A3A3E" to="#808080" angle=45 relative-to="workspace-view"
    }
    shadow {
        softness 30
        spread 5
        offset x=0 y=5
        color "#0007"
    }
    /-border {
        // off
        width 1
        active-color "#a6da95"
        inactive-color "#505050"
    }
    struts {
        // left 64
        // right 64
        // top 64
        // bottom 64
    }
}


// Overview configuration
overview {
    zoom 0.3
    backdrop-color "#262626"

    workspace-shadow {
        // off
        softness 40
        spread 10
        offset x=0 y=10
        color "#00000080"
    }
}


// Layer rules
layer-rule {
    match namespace="^swww-daemon$"
    place-within-backdrop true
}
layer-rule {
    match namespace="^quickshell-wallpaper$"
}
layer-rule {
    match namespace="^quickshell-overview$"
    place-within-backdrop true
}


// Startup applications
spawn-at-startup "xwayland-satellite"
spawn-at-startup "swww-daemon"
spawn-sh-at-startup "swww img ~/wallpaper/default.jpg"
//spawn-at-startup "~/.config/niri/waybar.sh"
spawn-sh-at-startup "qs -c noctalia-shell"
spawn-at-startup "swayosd-server"
//spawn-at-startup "swaync" "-c" "~/.config/swaync/config.json" "-s" "~/.config/swaync/style.css"
spawn-at-startup "wlsunset" "-l" "20.70" "-L" "-103.34"
spawn-at-startup "/usr/lib/polkit-gnome/polkit-gnome-authentication-agent-1"
spawn-at-startup "swayidle"
spawn-at-startup "blueman-applet"
//spawn-at-startup "/opt/ExpanDrive/expandrive" "--autorun"
spawn-sh-at-startup "~/Applications/ExpanDrive-2025.06.20_76b30d38989b8a7085b991b05018a8e0.AppImage"
spawn-at-startup "nm-applet" "--indicator"
spawn-at-startup "kdeconnectd"
spawn-at-startup "kdeconnect-indicator"
spawn-at-startup "copyq"
//spawn-at-startup "cosmic-ext-alternative-startup"
spawn-at-startup "niriswitcher"
spawn-at-startup "ferdium"
spawn-at-startup "zotero"
spawn-at-startup "logseq"
spawn-at-startup "niri" "msg" "action" "focus-workspace" "web"


// Client-side decorations
prefer-no-csd


// Screenshot configuration
screenshot-path "~/Pictures/Screenshots/Screenshot from %Y-%m-%d %H-%M-%S.png"
// screenshot-path null

xwayland-satellite {
    // off
    path "xwayland-satellite"
}


// Animations configuration
animations {
    // off
    slowdown 0.7
    workspace-switch {
        spring damping-ratio=1.0 stiffness=3000 epsilon=0.0001
    }
    window-open {
        duration-ms 80
        curve "ease-out-quad"
    }
    window-close {
        duration-ms 80
        curve "ease-out-cubic"
    }
    horizontal-view-movement {
        spring damping-ratio=1.0 stiffness=1900 epsilon=0.0001
    }
    window-movement {
        spring damping-ratio=1.0 stiffness=1800 epsilon=0.0001
    }
    window-resize {
        spring damping-ratio=1.0 stiffness=2000 epsilon=0.0001
    }
    config-notification-open-close {
        spring damping-ratio=0.6 stiffness=2200 epsilon=0.001
    }
    screenshot-ui-open {
        duration-ms 100
        curve "ease-out-quad"
    }
    overview-open-close {
        spring damping-ratio=1.0 stiffness=2900 epsilon=0.0001
    }
}


// Cursor configuration
cursor {
    xcursor-theme "Bibata-Modern-Ice"
    xcursor-size 24
    hide-when-typing
    hide-after-inactive-ms 1000
}


// Window rules
window-rule {
    match app-id=r#"^org\.wezfurlong\.wezterm$"#
    default-column-width {}
}

/-window-rule {
    match app-id=r#"^org\.keepassxc\.KeePassXC$"#
    match app-id=r#"^org\.gnome\.World\.Secrets$"#
    block-out-from "screen-capture"
    // block-out-from "screencast"
}

window-rule {
    geometry-corner-radius 0
    clip-to-geometry true
}

window-rule {
    match app-id="Logseq"
    open-on-workspace "notes"
    open-maximized true
    open-focused false
}

window-rule {
    match title=r#"^Zotero$"#
    open-on-workspace "ref"
    open-maximized true
    open-focused false
}

window-rule {
    match app-id=r#"[Ff]erdium"#
    match title=r#"^Planify$"#
    match title=r#"^Akregator$"#
    match app-id=r#"^io.github.martinrotter.rssguard$"#
    open-on-workspace "chat"
    open-maximized true
    open-focused true
}

window-rule {
    match title=r#"^Newsflash$"#
    open-on-workspace "chat"
    default-column-width { proportion 0.6; }
}

window-rule {
    match title=r#"^Waydroid$"#
    open-on-workspace "web"
    default-column-width { proportion 0.35; }
}

window-rule {
    match app-id="Zettlr"
    match app-id=r#"libreoffice"#
    match app-id=r#"soffice"#
    open-on-workspace "write"
    open-maximized true
    open-focused true
}

// Zotero floating
window-rule {
    match title=r#"^Progress$"#
    match title="Progress"
    open-floating true
}

window-rule {
    match app-id="virt-manager" title="Virtual Machine Manager"
    match app-id="virt-manager" title="Gestor de máquinas virtuales"
    default-column-width { proportion 0.25; }
    open-on-workspace "virt"
}

window-rule {
    match app-id="virt-manager" title=r#"QEMU/KVM$"#
    open-maximized true
    open-on-workspace "virt"
}

window-rule {
    match app-id="google-chrome"
    default-column-width { proportion 0.75; }
    open-focused true
}

window-rule {
    match app-id="doublecmd" title=r#"Double Commander"#
    match title=r#"^GitHub Desktop$"#
    match app-id=r#"^GitHub Desktop$"#
    default-column-width { proportion 0.6; }
    open-on-workspace "files"
}

window-rule {
    match app-id="doublecmd" title=r#"Copiar archivo"#
    default-column-width { proportion 0.3333; }
    open-on-workspace "files"
}

window-rule {
    match app-id=r#"jdownloader"#
    match app-id=r#"qbittorrent"#
    match title=r#"^JDownloader 2$"#
    default-column-width { proportion 0.3; }
    open-on-workspace "files"
    open-focused false
}

window-rule {
    match app-id=r#"io.github.nozwock.Packet"#
    open-focused false
    open-floating true
}

window-rule {
    match app-id="Alacritty"
    match app-id="kitty"
    match app-id="sublime_text"
    match app-id="thunar"
    match app-id="nemo"
    default-column-width { proportion 0.5; }
}

window-rule {
    match title=r#"Create Parent Item"#
    open-floating true
    min-height 250
}

window-rule {
    match app-id="nemo"
    open-floating true
    default-column-width { fixed 900; }
    default-floating-position x=130 y=200 relative-to="bottom-right"
    min-width 900
    min-height 700
    opacity 0.9
}

window-rule {
    match app-id="Alacritty"
    open-floating true
    default-column-width { fixed 1000; }
    default-floating-position x=250 y=50 relative-to="bottom-right"
    min-width 1000
    opacity 0.9
}

window-rule {
    match title=r#"^\s*$"#
    match title=r#"^Add/Edit Citation$"#
    match title=r#"^Zotero Settings$"#
    match title=r#"^Zotero Item Selector$"#
    match title=r#"^Found Duplicate Items$"#
    match title=r#"^Print$"#
    match title=r#"^Save File$"#
    match title="^(file_progress)$"
    match title="^(Smile)$"
    match title="^(confirm)$"
    match title="^(dialog)$"
    match title="^(download)$"
    match title="^(notification )$"
    match title="^(error)$"
    match title="^(splash)$"
    match title="^(nwg-look)$"
    match title="^(Subtitulado instantáneo)$"
    match title="^(confirmreset)$"
    match title="^(Delete profile)$"
    match title="^File Operation Progress$"
    match title="^Confirm to replace files$"
    match title="^KDE Connect URL handler$"
    match title="^(Open File)(.*)$"
    match title="^(Select a File)(.*)$"
    match title="^(Choose wallpaper)(.*)$"
    match title="^(Open Folder)(.*)$"
    match title="^(Save As)(.*)$"
    match title="^(Library)(.*)$"
    match title="^(File Upload)(.*)$"
    match title="^(hyprland-share-picker)$"
    match title="^(.*)-Google$"
    match title="^(.*)System Update$"
    match title=r#"^Progress$"#
    match title=r#"^(progress)$"#
    match app-id="^xdm-app$"
    open-floating true
}

window-rule {
    match is-active=false
    opacity 0.95
}

window-rule {
    match app-id=r#"com.github.th_ch.youtube_music"#
    match app-id=r#"Steam"#
    default-column-width { proportion 0.7; }
    open-on-workspace "media"
}


// Keybindings
binds {
    // General actions and system commands
    Mod+Shift+Slash { show-hotkey-overlay; }
    Mod+E { toggle-overview; }
    Mod+Q { close-window; }
    Mod+Shift+E { quit; }
    Mod+Shift+P { power-off-monitors; }
    Mod+Ctrl+Shift+F { toggle-windowed-fullscreen; }
    Mod+Ctrl+Shift+S { toggle-keyboard-shortcuts-inhibit; }

    // Application launchers and binds
    Mod+Space { spawn-sh "qs -c noctalia-shell ipc call launcher toggle"; }
    Mod+D { spawn "anyrun"; }
    Mod+Return { spawn "kitty"; }
    Mod+Shift+Z { spawn "nemo"; }
    Mod+period { spawn-sh "rofi -show drun"; }
    Mod+Shift+Return { spawn-sh "thunar /home/ruben/Downloads/"; }
    Mod+F1 { spawn "google-chrome-stable"; }
    Mod+F2 { spawn "ferdium"; }
    Mod+F3 { spawn "zotero"; }
    Mod+F4 { spawn "logseq"; }
    Mod+F5 { spawn "zettlr"; }
    Mod+F6 { spawn "doublecmd"; }
    Mod+F7 { spawn "virt-manager"; }
    Mod+F8 { spawn "qbittorrent"; }
    Mod+F9 { spawn "jdownloader"; }
    Mod+F10 { spawn "youtube-music"; }
    Mod+F11 { spawn "github-desktop"; }
    Mod+F12 { spawn "smile"; }
    Mod+Shift+N { spawn "newsflash"; }

    // System utility binds
    Mod+L { spawn "swaylock"; }
    //Mod+L { spawn "qs" "ipc" "call" "lockScreen" "toggle"; }
    Ctrl+Alt+Escape { spawn-sh "qs -c noctalia-shell ipc call lockScreen toggle"; }
    Mod+Shift+I { spawn-sh "qs -c noctalia-shell ipc call idleInhibitor toggle"; }
    //Mod+X { spawn "nwg-bar"; }
    Mod+X { spawn-sh "qs -c noctalia-shell ipc call powerPanel toggle"; }
    Mod+Z { spawn-sh "qs -c noctalia-shell ipc call launcher calculator"; }
    Mod+N { spawn-sh "qs -c noctalia-shell ipc call notifications toggleHistory"; }
    Mod+Shift+C { spawn-sh "qs -c noctalia-shell ipc call launcher clipboard"; }
    Mod+Shift+B { spawn-sh "qs -c noctalia-shell"; }
    Mod+B { spawn "~/.config/niri/waybar.sh"; }
    Mod+M { spawn-sh "mpv /dev/video2"; }
    Ctrl+Alt+P { spawn "pamac-manager"; }
    Mod+Shift+M { spawn-sh "wl-present mirror"; }
    Mod+Escape { spawn-sh "kitty btop"; }

    // Window navigation and focus
    Mod+Left { focus-column-left; }
    Mod+Down { focus-window-or-workspace-down; }
    Mod+Up { focus-window-or-workspace-up; }
    Mod+Right { focus-column-right; }
    Mod+Home { focus-column-first; }
    Mod+End { focus-column-last; }
    Mod+Tab { focus-workspace-previous; }

    // Window movement
    Mod+Ctrl+Left { move-column-left; }
    Mod+Ctrl+Down { move-window-down; }
    Mod+Ctrl+Up { move-window-up; }
    Mod+Ctrl+Right { move-column-right; }
    Mod+Ctrl+H { move-column-left; }
    Mod+Ctrl+J { move-window-down; }
    Mod+Ctrl+K { move-window-up; }
    Mod+Ctrl+L { move-column-right; }
    Mod+Ctrl+Home { move-column-to-first; }
    Mod+Ctrl+End { move-column-to-last; }
    Mod+I { consume-window-into-column; }
    Mod+O { expel-window-from-column; }
    Mod+BracketLeft { consume-or-expel-window-left; }
    Mod+BracketRight { consume-or-expel-window-right; }

    // Window resizing and layout
    Mod+R { switch-preset-column-width; }
    Mod+F { maximize-column; }
    Mod+C { center-column; }
    Mod+W { toggle-column-tabbed-display; }
    Mod+Shift+R { reset-window-height; }
    Mod+Shift+F { fullscreen-window; }
    Mod+Shift+W { expand-column-to-available-width; }
    Mod+Minus { set-column-width "-10%"; }
    Mod+Equal { set-column-width "+10%"; }
    Mod+Shift+Minus { set-window-height "-10%"; }
    Mod+Shift+Equal { set-window-height "+10%"; }
    Mod+T { toggle-window-floating; }

    // Monitor movement and focus
    Mod+Shift+Left { focus-monitor-left; }
    Mod+Shift+Down { focus-monitor-down; }
    Mod+Shift+Up { focus-monitor-up; }
    Mod+Shift+Right { focus-monitor-right; }
    Mod+Shift+Ctrl+Left { move-column-to-monitor-left; }
    Mod+Shift+Ctrl+Down { move-column-to-monitor-down; }
    Mod+Shift+Ctrl+Up { move-column-to-monitor-up; }
    Mod+Shift+Ctrl+Right { move-column-to-monitor-right; }
    Mod+Alt+Ctrl+Left { move-workspace-to-monitor-left; }
    Mod+Alt+Ctrl+Right { move-workspace-to-monitor-right; }
    // Mod+Shift+Ctrl+Left { move-window-to-monitor-left; }
    // Mod+Ctrl+Alt+Left { spawn "niri" "msg" "action" "move-workspace-to-monitor" "DP-2"; }
    // Mod+Ctrl+Alt+Right { spawn "niri" "msg" "action" "move-workspace-to-monitor" "HDMI-A-1"; }

    // Workspace navigation
    Mod+Page_Down { focus-workspace-down; }
    Mod+Page_Up { focus-workspace-up; }
    Mod+Ctrl+Page_Down { move-column-to-workspace-down; }
    Mod+Ctrl+Page_Up { move-column-to-workspace-up; }
    Mod+Ctrl+U { move-column-to-workspace-down; }
    Mod+Ctrl+I { move-column-to-workspace-up; }
    Mod+Shift+Page_Down { move-workspace-down; }
    Mod+Shift+Page_Up { move-workspace-up; }
    // Mod+U { focus-workspace-down; }
    // Mod+I { focus-workspace-up; }
    // Mod+Shift+U { move-workspace-down; }
    // Mod+Shift+I { move-workspace-up; }
    // Mod+Ctrl+Page_Down { move-window-to-workspace-down; }

    // Workspace by index
    Mod+1 { focus-workspace 1; }
    Mod+2 { focus-workspace 2; }
    Mod+3 { focus-workspace 3; }
    Mod+4 { focus-workspace 4; }
    Mod+5 { focus-workspace 5; }
    Mod+6 { focus-workspace 6; }
    Mod+7 { focus-workspace 7; }
    Mod+8 { focus-workspace 8; }
    Mod+9 { focus-workspace 9; }
    Mod+Shift+1 { move-column-to-workspace 1; }
    Mod+Shift+2 { move-column-to-workspace 2; }
    Mod+Shift+3 { move-column-to-workspace 3; }
    Mod+Shift+4 { move-column-to-workspace 4; }
    Mod+Shift+5 { move-column-to-workspace 5; }
    Mod+Shift+6 { move-column-to-workspace 6; }
    Mod+Shift+7 { move-column-to-workspace 7; }
    Mod+Shift+8 { move-column-to-workspace 8; }
    Mod+Shift+9 { move-column-to-workspace 9; }
    // Mod+Ctrl+1 { move-window-to-workspace 1; }

    // Screenshots
    Print { screenshot; }
    Ctrl+Print { screenshot-screen; }
    Alt+Print { screenshot-window; }
    Mod+Print { spawn "~/.config/niri/screenshot_swappy.sh"; }

    // Multimedia and peripherals
    XF86AudioLowerVolume { spawn "swayosd-client" "--output-volume" "lower"; }
    XF86AudioMute { spawn "swayosd-client" "--output-volume" "mute-toggle"; }
    XF86AudioRaiseVolume { spawn "swayosd-client" "--output-volume" "raise"; }
    XF86MonBrightnessDown { spawn "swayosd-client" "--brightness" "lower"; }
    XF86MonBrightnessUp { spawn "swayosd-client" "--brightness" "raise"; }
    F11 { spawn "swayosd-client" "--output-volume" "lower"; }
    F10 { spawn "swayosd-client" "--output-volume" "mute-toggle"; }
    F12 { spawn "swayosd-client" "--output-volume" "raise"; }

    // Mouse wheel binds
    Mod+WheelScrollDown cooldown-ms=150 { focus-workspace-down; }
    Mod+WheelScrollUp cooldown-ms=150 { focus-workspace-up; }
    Mod+Ctrl+WheelScrollDown cooldown-ms=150 { move-column-to-workspace-down; }
    Mod+Ctrl+WheelScrollUp cooldown-ms=150 { move-column-to-workspace-up; }
    Mod+WheelScrollRight { focus-column-right; }
    Mod+WheelScrollLeft { focus-column-left; }
    Mod+Ctrl+WheelScrollRight { move-column-right; }
    Mod+Ctrl+WheelScrollLeft { move-column-left; }
    Mod+Shift+WheelScrollDown { focus-column-right; }
    Mod+Shift+WheelScrollUp { focus-column-left; }
    Mod+Ctrl+Shift+WheelScrollDown { move-column-right; }
    Mod+Ctrl+Shift+WheelScrollUp { move-column-left; }
    Mod+Ctrl+MouseLeft { close-window; }
    Mod+MouseMiddle { maximize-column; }

    // Touchpad binds
    Mod+TouchpadScrollDown { spawn "wpctl" "set-volume" "@DEFAULT_AUDIO_SINK@" "0.02+"; }
    Mod+TouchpadScrollUp { spawn "wpctl" "set-volume" "@DEFAULT_AUDIO_SINK@" "0.02-"; }

    // Switcher binds
    Alt+Tab repeat=false { spawn "niriswitcherctl" "show" "--window"; }
    Alt+Shift+Tab repeat=false { spawn "niriswitcherctl" "show" "--window"; }
    Alt+1 repeat=false { spawn "niriswitcherctl" "show" "--workspace"; }
    Alt+Shift+1 repeat=false { spawn "niriswitcherctl" "show" "--workspace"; }
}


// Hotkey overlay configuration
hotkey-overlay {
    skip-at-startup
}


// Debug options
debug {
    honor-xdg-activation-with-invalid-serial
}


// Environment variables
environment {
    // Wayland and session
    // DISPLAY ":0"
    XDG_SESSION_TYPE "wayland"
    XDG_SESSION_DESKTOP "Niri"
    XDG_CURRENT_DESKTOP "Niri"
    // WAYLAND_DISPLAY "wayland-1"
    MOZ_ENABLE_WAYLAND "1"
    CLUTTER_BACKEND "wayland"
    GDK_BACKEND "wayland,x11"
    ECORE_EVAS_ENGINE "wayland-egl"
    WINIT_UNIX_BACKEND "wayland"
    SDL_VIDEODRIVER "wayland"
    BEMENU_BACKEND "wayland"
    XDG_BACKEND "wayland"
    ELECTRON_OZONE_PLATFORM_HINT "auto" //No funciona Logseq

    // UI theming and scaling
    QT_QPA_PLATFORM "wayland"
    QT_WAYLAND_DISABLE_WINDOWDECORATION "1"
    QT_AUTO_SCREEN_SCALE_FACTOR "1"
    QT_SCALE_FACTOR "1"
    GDK_SCALE "1"
    GTK_THEME "catppuccin-mocha-blue-standard+default"
    XCURSOR_THEME "Bibata-Modern-Ice"
    XDG_SCREENSHOTS_DIR "$HOME/Pictures/Screenshots"
    QT_QPA_PLATFORMTHEME "gtk3"
    QT_QPA_PLATFORMTHEME_QT6 "gtk3"
    //QT_QPA_PLATFORMTHEME "qt5ct"
    //QT_QPA_PLATFORMTHEME_QT6 "qt6ct"


    // Application specific
    BROWSER "google-chrome-stable"
    CHROME_EXECUTABLE "google-chrome-stable"
    EDITOR "subl"
    _JAVA_AWT_WM_NONREPARENTING "1"
    _JAVA_OPTIONS "-Dawt.useSystemAAFontSettings=gasp"
    MANGOHUD "0"
    MANGOHUD_DLSYM "1"
}
